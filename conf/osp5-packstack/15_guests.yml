# network aliases (see conf/openstack/10_networks.yml):
management_network: &management_network mgmt
storage_network: &storage_network storage
tenant_network: &tenant_network tenant
external_network: &external_network external

common:
  virtinst:
    os_variant: rhel7
    location: /var/lib/libvirt/images/rhel-server-7.0-x86_64-dvd.iso

guests:
  - name: allinone
    description: OpenStack All-in-One node

    setup_data:
      - src: data/openstack/Makefile
        dst: Makefile
      - src: data/openstack/allinone_answers.txt
        dst: answers.txt

    templates:
      autoinst:
        src: autoinstall.d/openstack-allinone-ks.cfg

    disks:
      - pool: default
        format: qcow2
        cache: none
        size: 70  # 50G (data) + 20 G (system)
        bus: scsi

    virtinst:
      cpu: host  # Needed to enable nested KVM feature

    guests:
      - hostname: allinone-0
        fqdn: allinone-0.openstack.example.com
        ip: &openstack_allinone_0_ip_0 192.168.200.10
        interfaces:
          # eth0: access from/to public network
          - mac: "52:54:00:16:82:10"
            ip: *openstack_allinone_0_ip_0
            network: *public_network

          # eth1: acccess from/to vms inside this node via bridges
          - mac: "52:54:00:16:82:11"
            ip: 192.168.200.11
            network: *public_network

        packstack:
          controller_ip: *openstack_allinone_0_ip_0
          compute_ips:
            - *openstack_allinone_0_ip_0

  - name: controller
    description: RHEL-OSP5 controller node

    setup_data:
      - src: data/openstack/Makefile
        dst: Makefile
      - src: data/openstack/controller_answers.txt
        dst: answers.txt
      - src: data/openstack/localrepo.repo.txt
        dst: localrepo.repo

    templates:
      autoinst:
        src: autoinstall.d/osp5-controller-ks.cfg

    disks:
      - pool: default
        format: qcow2
        cache: none
        size: 20  # system
        bus: scsi
      - pool: default
        vol: cinder-volumes-controller-1
        format: qcow2
        cache: none
        size: 11  # cinder-volumes
        bus: scsi

    guests:
      - hostname: controller-1
        fqdn: controller-1.mgmt.local
        ip: &openstack_controller_1_ip_0 10.0.1.11
        interfaces:
          # eth0: mgmt
          - mac: "52:54:10:01:00:11"
            ip: *openstack_controller_1_ip_0
            network: *management_network

          # eth1: storage
          - mac: "52:54:10:00:00:11"
            ip: 10.0.0.11
            network: *storage_network

          # eth2: tenant
          - mac: "52:54:10:02:00:11"
            ip: 10.0.2.11
            network: *tenant_network

          # eth3: external
          - mac: "52:54:10:03:00:11"
            ip: 172.16.99.11
            network: *external_network

        openstack_compute_nodes:
          - &openstack_compute_1_ip_0 &openstack_compute_2_ip_0

        packstack:
          controller_ip: *openstack_controller_0_ip_0
          compute_ips:
            - *openstack_compute_0_ip_0

  - name: compute
    description: OpenStack Compute node

    templates:
      autoinst:
        src: autoinstall.d/osp5-compute-ks.cfg

    virtinst:
      cpu: host

    guests:
      - hostname: compute-1
        fqdn: compute-1.mgmt.local
        ip: *openstack_compute_1_ip_0 10.0.1.101
        interfaces:
          # eth0: mgmt
          - mac: "52:54:10:01:01:01"
            ip: *openstack_compute_1_ip_0
            network: *management_network

          # eth1: storage
          - mac: "52:54:10:00:01:01"
            ip: 10.0.0.101
            network: *storage_network

          # eth2: tenant
          - mac: "52:54:10:02:01:01"
            ip: 10.0.2.101
            network: *tenant_network

      - hostname: compute-2
        fqdn: compute-2.mgmt.local
        ip: *openstack_compute_2_ip_0 10.0.1.102
        interfaces:
          # eth0: mgmt
          - mac: "52:54:10:01:01:02"
            ip: *openstack_compute_2_ip_0
            network: *management_network

          # eth1: storage
          - mac: "52:54:10:00:01:02"
            ip: 10.0.0.102
            network: *storage_network

          # eth2: tenant
          - mac: "52:54:10:02:01:02"
            ip: 10.0.2.102
            network: *tenant_network

# vim:sw=2:ts=2:et:
